/*! 
 * ec-payment-menu v3.40.0
 * https://dev.esewa.com.np
 * Version: 3.40.0
+; * Copyright (c) 2022 eSewa Developers <developers@esewa.com.np>
 * License: eSewa
 */
angular.module("esewaPaymentMenuApp",["restangular","ngStorage","esewaMessages","esewaSharedApp","ui.router","infinite-scroll"]).run(["$rootScope","$state","$localStorage","$http","$timeout","$sce","$location","$templateCache",function(a,b,c,d,e,f,g,h){}]),angular.module("esewaPaymentMenuApp").controller("ProductListController",["$scope","$stateParams","PaymentMenuService","$rootScope",function(a,b,c,d){d.setDocumentTitle(b.productCategory+" Product Listing"),c.getPaymentMenu().then(function(c){d.productMenus=c,"category"===b.productCategory?a.products=c[0]:a.products=c.filter(function(a){return a.name===b.productCategory})[0]}),a.switchCategory=function(b){a.products=d.productMenus.filter(function(a){return a.name===b})[0],console.log(a.products)}}]),angular.module("esewaPaymentMenuApp").directive("copyToClipboard",function(){return{restrict:"A",link:function(a,b,c){b.click(function(){if(c.copyToClipboard){var a=$("<input>");$("body").append(a),a.val(c.copyToClipboard).select(),document.execCommand("copy"),a.remove()}})}}}),angular.module("esewaPaymentMenuApp").factory("PaymentMenuFactory",[function(){var a=[];return{setPaymentMenus:function(b){a=b},getPaymentMenu:function(){return a}}}]),angular.module("esewaPaymentMenuApp").factory("ShowcaseFactory",[function(){var a=[],b=[];return{setShowcaseData:function(b){a=b},getShowCaseData:function(){return a},setSameCatagoryShowcase:function(a){b=a},getSameCatagoryShowcase:function(){return b}}}]),angular.module("esewaPaymentMenuApp").controller("OfferDetailController",["$scope","$stateParams","CDNUrl","$rootScope","$localStorage","OfferService","$window","RedeemPromocodeService","$state","$modal",function(a,b,c,d,e,f,g,h,i,j){var k={page:0,size:25};f.getOffer(k).then(function(b){a.offerList=b.plain()}),a.availablePromocode=[],a.showPromocodeDetail=function(b){a.detail=b,a.$modalInstance=j.open({templateUrl:c.url+"/html/templates/promocode/promocode_detail_3.39.0.html",scope:a})},a.close=function(){a.$modalInstance.dismiss("cancel")},a.goToPromotionPage=function(){a.showDd=!1,i.go("redeemPromo.eligible")},a.goToOfferPage=function(a){g.open(a,"_blank")}}]),angular.module("esewaPaymentMenuApp").service("OfferService",["Restangular",function(a){var b=a.all("auth");this.getOffer=function(a){return b.one("offers").get(a)}}]),angular.module("esewaPaymentMenuApp").controller("PaymentMenuController",["$state","$scope","$rootScope","StateConstant","$timeout","$location","PaymentMenuService",function(a,b,c,d,e,f,g){function h(a){angular.isDefined(a)&&(c.productMenus=a.plain(),c.bannerLoader=!!c.productMenus,i())}function i(){(a.current.name===d.HOME_MAIN||a.current.name===d.LOGIN||a.current.name.startsWith("merchant"))&&(c.showPaymentMenu=!0),c.bannerLoader=!0,b.productMenus=c.productMenus,_.each(b.productMenus,function(a,c){b.showChildMenus[c]=!1}),j()}function j(){c.$$phase||c.$apply()}b.showChildMenus=[],b.menu={product:{}},a.current.name!==d.LOGIN&&a.current.name!==d.HOME_MAIN&&"organization.home"!==a.current.name||(c.showAddServices=!0),angular.isUndefined(c.productMenus)?g.getPaymentMenu().then(function(a){h(a)},function(){c.productMenus=[],j()}):i(),b.getThePaymentClass=function(a){return temp=4*a,"col-lg-"+temp},b.getThePaymentInnerClass=function(a){return colVal=12/a,"col-lg-"+colVal},b.showChildMenu=function(a,d){if(c.globalclick=!1,"School & College"===d.name)return void c.goToState("schoolAndCollege");e(function(){if("AGGREGATE"===d.menuType)return void f.path(d.aggregateUrl);_.each(b.showChildMenus,function(c,d){b.showChildMenus[d]=d===a&&!b.showChildMenus[d]})},0)},b.closeAllMenus=function(){c.globalclick=!0},b.getDetails=function(b,e,g){c.isAuthenticated()?"AGGREGATE"===g.menuType?f.path(g.aggregateUrl):a.go(d.MAKE_PAYMENT,{product_code:b,product_name:e},{reload:!0}):c.openLoginDialog("/#/make_payment/"+b+"/"+e)};var k=["auth","authentication","user","activateNotification","activate","merchant.airlines","static","home.main.initialRequirement","fundFrom"],l=["user.statements","static","fundFrom"];c.$on("$stateChangeSuccess",function(){document.body.scrollTop=document.documentElement.scrollTop=0,c.currentModal&&!a.current.name.startsWith(d.MAKE_PAYMENT)&&c.currentModal.dismiss(),c.showMostUsedServices=!1,c.showAddServices=!1,c.showPaymentMenu=!0,a.current.name===d.LOGIN||a.current.name===d.HOME_MAIN?(c.showMostUsedServices=!0,c.showAddServices=!0,c.message.error=""):a.current.name.startsWith("static")&&(c.message.error=""),c.showBreadCumb=!0,_.each(k,function(b){_.startsWith(a.current.name,b)&&(c.showPaymentMenu=!1,c.showBreadCumb=!1)}),_.each(l,function(b){(_.startsWith(a.current.name,b)||"login"===a.current.name||"main.landing"===a.current.name)&&(c.showBreadCumb=!1)})})}]).directive("paymentMenulist",[function(){return{restrict:"A",transclude:!1,link:function(a,b){a.$last&&$(".paymentMenu-parent").mouseenter(function(){var a=$(this),b=setTimeout(function(){a.addClass("hasBeen500ms")},500);a.mouseleave(function(){clearTimeout(b),a.removeClass("hasBeen500ms")})})}}}]).directive("onOutsideElementClick",["$document",function(a){return{restrict:"A",link:function(b,c,d){c.on("click",function(a){a.stopPropagation()});var e=function(){b.$$phase||b.$apply(function(){b.$eval(d.onOutsideElementClick)})};a.on("click",e),b.$on("$destroy",function(){a.off("click",e)})}}}]),angular.module("esewaPaymentMenuApp").service("PaymentMenuService",["Restangular",function(a){this.getProductForPayment=function(b){return a.all("payments").all("products").one(b).get()},this.getPaymentMenu=function(){return a.one("payment_menus").customGET()}}]),angular.module("esewaPaymentMenuApp").controller("ProductSearchController",["$scope","$filter","$window","$rootScope","$http","$location","$state","StateConstant","CDNUrl","ProductSearchService","$localStorage","AUTH_EVENTS",function(a,b,c,d,e,f,g,h,i,j,k,l){function m(b){angular.isDefined(b)&&e.get(b).success(function(b){angular.isDefined(b)&&(a.infoSectionObj=b)})}function n(b){var c=p(b,d.$storage.recentSearchList);if(d.$storage.recentSearchList.length>0&&(a.productSearchMap=angular.copy(d.$storage.recentSearchList)),!c){var e={name:b,isEmpty:!1,section:"recentSearchItem"};d.$storage.recentSearchList.unshift(e);d.$storage.recentSearchList.length>5&&(a.toBeDeletedSearchListItem=d.$storage.recentSearchList[0],d.$storage.recentSearchList.splice(5,5),a.productSearchMap=a.productSearchMap.filter(function(b){return b.name!=a.toBeDeletedSearchListItem.name&&"recentSearchItem"===b.section})),d.$$phase||d.$apply(),a.productSearchMap.push(e)}}function o(a,b){return b.filter(function(b){return b.section===a}).length>0}function p(a,b){return b.filter(function(b){return b.name.name===a.name}).length>0}function q(a,b){return{displayName:a.name,name:a.name,isDiffrentMerchant:b,code:a.code,image:a.logo,icon:a.icon,url:a.url,redirect:a.redirectExternal,section:"product"}}function r(a){return{displayName:a.data.displayName||"Not Available",name:a.name,image:a.data.logo,icon:a.data.icon,url:a.url,redirect:!1,section:"feature"}}function s(a,b){return{displayName:a.displayName,name:a.name,image:a.logo||"/common/images/esewa-icon-large.png",isDifferentMerchant:b,state:a.state,url:a.url,redirect:a.redirectExternal,section:"service"}}a.searching=!1,a.product="",a.productSearchMap=[],a.toBeDeletedSearchListItem=null,angular.isDefined(k.recentSearchList)||(k.recentSearchList=[]);var t={},u={};a.infoSectionObj={};var v="";a.getInfoSectionDataUrl=function(){switch(d.isAuthenticated()?"Authorized":"Unauthorized"){case"Authorized":switch(u?u&&"POINT"===u.organizationType?"Point":t&&angular.isDefined(t.isVerified)?"User":"Zone":"Zone"){case"User":var b=t&&t.isVerified?"Verified":"Unverified";v="Verified"==b?i.url+"/data/product-search/authorizedAndVerifiedUser.json":i.url+"/data/product-search/authorizedAndUnverifiedUser.json",m(v);break;case"Point":v=i.url+"/data/product-search/authorizedPoint.json",m(v);break;default:a.infoSectionObj={}}break;case"Unauthorized":v=i.url+"/data/product-search/unauthorizedUser.json",m(v)}},d.$on(l.socket,function(){t=d.$storage.profile||{},u=d.$storage.user||{},a.getInfoSectionDataUrl()}),d.isAuthenticated()||a.getInfoSectionDataUrl(),a.handleInfoSectionAction=function(){if(a.infoSectionObj.buttonAction.isRedirect){var e=b("UrlCode")(null!==a.infoSectionObj.buttonAction.url||""!==a.infoSectionObj.buttonAction.url?a.infoSectionObj.buttonAction.url:a.infoSectionObj.buttonAction.name);c.open(e,"_blank")}else if(d.isAuthenticated())d.goToState(a.infoSectionObj.buttonAction.name);else{var f="#"+a.infoSectionObj.buttonAction.url;d.openLoginDialog(f)}},a.showRecentSearchList=d.$storage.recentSearchList.length;var w=[],x=d.$storage.user?i.url+"/data/orgProductSearch.json":i.url+"/data/userProductSearch.json";e.get(x).success(function(a){angular.isDefined(a.data)&&(w=a.data)});var y=[],z=(d.$storage.user,i.url+"/data/userServiceSearch.json");e.get(z).success(function(a){angular.isDefined(a.data)&&(y=a.data)});var A=g.get();A=A.filter(function(a){if(angular.isDefined(a.data)&&angular.isDefined(a.data.searchParams))return a}),a.search=function(b){a.searching=!0,a.product=b,a.productSearchMap=[],a.toBeDeletedSearchListItem=null;var d=[],e=[];if(c.trackLogEvent&&b.length>=3&&c.trackLogEvent({eventTitle:b,eventType:"search"}),w.forEach(function(c){c.params.toLowerCase().includes(b.toLowerCase())&&a.productSearchMap.push(q(c,!0))}),y.forEach(function(c){b.trim().length?c.params.toLowerCase().includes(b.toLowerCase())&&a.productSearchMap.push(s(c,!1)):a.productSearchMap.push(s(c,!1))}),A.forEach(function(c){if(angular.isDefined(c.data)&&c.data.hasOwnProperty("searchParams")){_.filter(c.data.searchParams,function(a){return a.toLowerCase().includes(b.toLowerCase())}).length>0&&a.productSearchMap.push(r(c))}}),b.trim().length>2){var f={q:b};return j.getSearchResults(f).then(function(c){if(!c)return a.showService=o("service",a.productSearchMap),a.productSearchMap;if(a.searching=!1,0===c.length)0===a.productSearchMap.length&&a.productSearchMap.push({name:"Product not available."});else{for(var f=0;f<c.length;f++)c[f].redirectExternal?d.push(q(c[f])):e.push(q(c[f]));e.length&&e.push({saperatorLine:!0}),a.productSearchMap=a.productSearchMap.concat(e,d)}return b.trim().length&&(a.showFeature=o("feature",a.productSearchMap),a.showProduct=o("product",a.productSearchMap)),a.showService=o("service",a.productSearchMap),a.productSearchMap},function(b){return a.productSearchMap})}return a.searching=!1,a.showFeature=!1,a.showProduct=!1,a.showService=o("service",a.productSearchMap),a.productSearchMap},a.clearRecentSearchList=function(){k.recentSearchList=[]},a.clearSelectedRecentSearchList=function(a){d.$storage.recentSearchList=d.$storage.recentSearchList.filter(function(b){return b!==a})},a.setSearchTerm=function(b){a.product=b},a.clearSearchTerm=function(){a.product=""},a.onItemSelection=function(e,f){if(e)switch(n(e),c.trackLogEvent&&c.trackLogEvent({eventTitle:e.name,eventType:"select_content"}),e.section){case"recentSearchItem":a.setSearchTerm(e.name);break;case"feature":d.isAuthenticated()?d.goToState(e.name):(url="#"+e.url,d.openLoginDialog(url));break;case"product":if(e.isDiffrentMerchant)d.goToState(e.code);else if(e.redirect){if(e.redirect){var i=b("UrlCode")(null!==e.url||""!==e.url?e.url:e.code);c.open(i,"_blank")}}else d.isAuthenticated()?g.go(h.MAKE_PAYMENT,{product_code:e.code,product_name:e.name}):d.openLoginDialog("/#/make_payment/"+e.code+"/"+e.name);break;case"service":if(e.redirect){if(e.redirect){var j=b("UrlCode")(null!==e.url||""!==e.url?e.url:e.code);c.open(j,"_blank")}}else d.isAuthenticated()?g.go(h.MAKE_PAYMENT,{product_code:e.code,product_name:e.name}):d.openLoginDialog("/#/make_payment/"+e.code+"/"+e.name)}}}]),angular.module("esewaPaymentMenuApp").service("ProductSearchService",["Restangular",function(a){this.getSearchResults=function(b){return a.all("payments").all("products").withHttpConfig({selfHandleLoadingBar:!0}).customGET("",b)}}]),angular.module("esewaPaymentMenuApp").controller("RedeemPromocodeController",["$scope","$rootScope","RedeemPromocodeService","CDNUrl","$modal",function(a,b,c,d,e){function f(){c.getAvailablePromocode().then(function(b){a.elligiblePromocodeList=b.plain()})}function g(){c.getAllAvailablePromocode().then(function(b){a.availablePromocodeList=b.plain()})}a.message={error:"",success:""},a.page=1,a.size=8,a.usedPromocode="",a.elligiblePromocodeList=[],a.availablePromocodeList=[],a.promocodeInitialView="available",a.btnLabel="Apply",f(),g(),a.showPromocodeDetail=function(b){a.detail=b,a.$modalInstance=e.open({templateUrl:d.url+"/html/templates/promocode/promocode_detail_3.39.0.html",scope:a})},a.clearAppliedPromocode=function(){a.searchedPromocode=void 0,a.btnLabel="Apply",a.message.success="",a.message.error=""},a.close=function(){a.$modalInstance.dismiss("cancel")},a.fetchPromocodeValue=function(b){a.message.success="",a.message.error="",c.getPromocodeDetail(b).then(function(b){a.searchedPromocode=b.plain(),a.btnLabel="Applied"},function(b){a.message.error=b.data.error_message})},a.closeMsg=function(){a.message.success="",a.message.error=""},a.applyPromocode=function(d){a.message={error:"",success:""};var e={promo_code:d,product_id:0,product_type:null,module_id:b.isUser()?3:4,amount:0};c.redeemPromocode(e).then(function(b){a.usedPromocode="",a.searchedPromocode=void 0,a.btnLabel="Apply",a.message.success="Successfully Redeemed."},function(c){b.showErrorSuccessMessage(c,!0,"ERROR_ON_SERVING_REQUEST"),a.message.error=c.data.error_message})}}]),angular.module("esewaPaymentMenuApp").service("RedeemPromocodeService",["Restangular",function(a){this.getAvailablePromocode=function(){return a.all("auth/promocode").one("offer").getList()},this.getAllAvailablePromocode=function(){return a.all("auth/promocode").one("offer/list").getList()},this.getPromocodeDetail=function(b){return a.all("auth/promocode/offer/"+b).one("details").get()},this.redeemPromocode=function(b){return a.all("auth/promocode/redeem").customPOST(b)}}]),angular.module("esewaPaymentMenuApp").controller("SchoolCollegeController",["$scope","CDNUrl","$rootScope","PaymentMenuService","$http",function(a,b,c,d,e){e.get(b.url+"/data/schoolBanner.json").then(function(b){a.contents=b.data}),d.getPaymentMenu().then(function(b){a.schoolCollege=b.plain().filter(function(a){return"School & College"===a.name})[0]})}]),angular.module("esewaPaymentMenuApp").directive("owlCarouselItem",[function(){return{restrict:"A",transclude:!1,link:function(a,b){a.$last&&a.initCarousel(b.parent())}}}]).directive("owlCarousel",function(){return{restrict:"E",transclude:!1,link:function(a){a.initCarousel=function(b){var c={},d=a.$eval($(b).attr("data-options"));for(var e in d)c[e]=d[e];$(b).owlCarousel(c).owlCarousel({loop:!0,nav:!0,margin:10,responsive:{0:{items:1},600:{items:3},960:{items:5},1200:{items:6}}})}}}}),angular.module("esewaPaymentMenuApp").controller("ShowcaseController",["$scope","$rootScope","$state","ShowcaseFactory","ShowcaseService","$modal","$window","$sce","CDNUrl",function(a,b,c,d,e,f,g,h,i){a.data={showcases:[]},a.showcaseFactory=d,a.getShowCaseDataFromServer=function(){if(a.showcaseFactory.getShowCaseData().length)return void(a.data.showcases=a.showcaseFactory.getShowCaseData());e.getShowcase().then(function(c){for(var d=[],e=c.plain(),f=0;f<e.length;f++)d.push({name:e[f].name,badge:e[f].badge,detail:e[f].detail,logo:e[f].image_url,offer:e[f].offer,order:e[f].position,code:e[f].code,showcased:e[f].showcase,value:e[f].value,displayName:e[f].displayName});Object.assign(a.data.showcases,d),a.showcaseFactory.setShowcaseData(a.data.showcases),b.showcaseLoader=!!a.data.showcases},function(){return[]})},a.getProductShowcaseDetail=function(d,e){if(d.detail&&e)angular.isObject(d.detail)||(d.detail=h.trustAsHtml(d.detail)),a.openShowcaseDetailDialog(d);else{if(angular.isDefined(b.isAuthenticated)&&!b.isAuthenticated())return void b.openLoginDialog("/#/make_payment/"+d.code+"/"+d.displayName);c.go("merchant.makePayment",{product_code:d.code,product_name:d.name},{reload:!0})}},a.redirectToExternalUrl=function(a){g.open(a,"_blank")},a.openShowcaseDetailDialog=function(a){f.open({templateUrl:i.url+"/html/showcase/modal_showcase_detail.html",controller:j,size:"lg ShowcaseDetails",resolve:{showcase:function(){return a}}})},a.showcaseViewAll=function(b){e.getShowcaseByLevel(b).then(function(b){a.allShowcase=b.plain(),a.showcaseFactory.setSameCatagoryShowcase(b.plain()),c.go("allShowcase")},function(a){})};var j=["$rootScope","$scope","showcase","$modalInstance",function(a,b,c,d){b.showcase=c,b.cancel=function(){d.dismiss()},a.currentModal=d}]}]),angular.module("esewaPaymentMenuApp").factory("ShowcaseFactory",[function(){var a=[],b=[];return{setShowcaseData:function(b){a=b},getShowCaseData:function(){return a},setSameCatagoryShowcase:function(a){b=a},getSameCatagoryShowcase:function(){return b}}}]),angular.module("esewaPaymentMenuApp").service("ShowcaseService",["Restangular","PaginationService",function(a){this.getShowcase=function(){return a.all("products").all("showcase").getList()},this.getShowcaseByLevel=function(b){return a.all("products").all("showcase/"+b).customGET()}}]),angular.module("esewaPaymentMenuApp").config(["$stateProvider","$urlRouterProvider","CDNUrl",function(a,b,c){function d(a){return c.url+a}a.state("allShowcase",{templateUrl:d("/html/templates/v1/all_showcase.html"),data:{displayName:"All Showcase"}}).state("schoolAndCollege",{url:"/school-college",controller:"SchoolCollegeController",templateUrl:d("/html/templates/school_college.html"),data:{searchParams:["school","college"],displayName:"School and College",icon:"icon-es-school"}}).state("redeemPromo",{url:"/redeem-promocode",controller:"RedeemPromocodeController",templateUrl:d("/html/templates/promocode/redeem_promocode_3.39.0.html"),data:{searchParams:["redeem promocode"],displayName:"Redeem Promocode",icon:"icon-es-promocode"}}).state("redeemPromo.available",{url:"/available",templateUrl:d("/html/templates/promocode/available_promocode.html"),data:{displayName:"Available Promocode"}}).state("redeemPromo.eligible",{url:"/eligible",templateUrl:d("/html/templates/promocode/eligible_promocode.html"),data:{displayName:"Eligible Promocode"}}).state("productList",{url:"/products/:productCategory",controller:"ProductListController",templateUrl:d("/html/templates/all_products_list.html")})}]);