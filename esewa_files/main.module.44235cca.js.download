/*! 
 * esewaHomeApp v0.0.0
 * 
 * Copyright (c) 2023 eSewa Developers <developers@esewa.com.np>
 * License: eSewa
+; * Version: 0.0.0
+; */
!function(){angular.module("esewaUserApp",["ui.router","restangular","ui.bootstrap","infinite-scroll","esewaComponents","esewaMessages","esewaSharedApp","esewaPaymentMenuApp","vcRecaptcha","ngCookies","base64"]).run(["$rootScope","$state","$http","$modal","AUTH_EVENTS","AuthService","$timeout","$sce","$location","StateConstant","CDNUrl","$templateCache","ecmsg","$cookies",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){a.$state=b,a.StateConstant=j,a.successResponse={message:""},a.message={error:"",success:"",information:"",show:!1},a.cleanStorage=function(){a.initialRequirement={},a.userBalance="",a.UserRewardPoint="",a.dismissModal=!0};var o=n.get("errormsg"),p=n.get("successmsg");o&&o.length>3?m.error(o,""):p&&p.length>3&&m.success(p,""),a.logout=function(){a.clearMessage(),a.cleanStorage();var c=document.querySelector("#ACCOUNT_ICON");c&&(c.src=k.defaultAccountUrl),b.current.name.startsWith("login")||b.go("login")},a.currentModal=void 0,a.isLoggedIn=function(){var b=a.userAuth;return angular.isDefined(b)&&angular.isDefined(b.uuid)},a.isAuthenticated=function(){return a.isLoggedIn()},a.$on(e.loginSuccess,function(){a.initialRequirement.form||(a.targetLogin?a.serveUrlChanges():(b.current.name.startsWith("static")||b.current.name.startsWith("authentication"))&&b.go(j.HOME_MAIN))}),a.$on(e.loginFailed,function(){a.targetLogin||a.logout()}),a.$on(e.notAuthenticated,function(){a.targetLogin||a.logout()}),a.$on(e.notAuthorized,function(){a.targetLogin||a.logout()}),a.$on(e.sessionTimeout,function(){m.error("","Session expired. Please login again."),a.logout()}),a.clearMessage=function(){a.message={},a.dismissModal=!0,a.information={},a.trustedHtml="",a.showInformation=!1,a.credentials={},a.currentModal&&a.currentModal.dismiss()},a.serveUrlChanges=function(){i.absUrl()==a.targetLogin,a.currentModal&&a.currentModal.dismiss()},a.$on("$stateChangeStart",function(b,c,d){a.information={},a.message={},a.showInformation=!1,"login"!==c.name&&"allShowcase"!==c.name&&"download"!==c.name&&g(function(){a.isAuthenticated()||c.name.startsWith("authentication")||c.name.startsWith("static")||c.name.startsWith("serviceList")||c.name.startsWith("main")||c.name.startsWith("activate")||c.name.startsWith("productList")||c.name.startsWith("merchant.makePayment")||c.name.startsWith("merchant.airlines")||(a.$broadcast(e.notAuthenticated),b.preventDefault())},10)}),b.current.name.startsWith("home")&&(a.showMostUsedServices=!0,a.showAddServices=!0),a.getParentStyle=function(){return b.current.name.startsWith("merchant.airlines")?"padding-left:0px":""},a.showErrorMessage=function(){return!(!a.message||a.targetLogin)&&(a.message.error&&!(b.current.name.startsWith("auth")&&a.isAuthenticated()))},a.generateCaptcha=function(a){var b=document.querySelector("#CAPTCHA");c({method:"GET",url:"/api/web/captcha/"+a,headers:{"Content-Type":void 0,Accept:"data:image/png;charset=utf-8;base64"},responseType:"arraybuffer",data:""}).success(function(a){var c=new Blob([a],{type:"image/png"}),d=window.URL||window.webkitURL,e=d.createObjectURL(c);b&&(b.src=e)}).error(function(){})},a.openSignUpDialog=function(a){return d.open({templateUrl:"/user/authentication/views/sign_up_form.html",controller:"SignUpPopUpController",size:"signUp",backdrop:"static",keyboard:!1,resolve:{loginData:function(){return a}}})},g(function(){var b=i.port();80!==b&&(b=":"+b),a.domainName=i.protocol()+"://"+i.host()+b,i.port()===e.devGruntPort&&(a.domainName=i.protocol()+"://"+i.host()+":"+e.devServerPort)},3e3),g(function(){c({method:"GET",url:"/api/web/captcha_server_code",headers:{"Content-Type":void 0,Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8"},data:""}).success(function(b){a.publicKey=b.trim()}).error(function(){})},100)}])}(),function(){angular.module("esewaUserApp").config(["$stateProvider","$urlRouterProvider","CDNUrl",function(a,b,c){function d(a){return c.url+a}b.otherwise("/home"),a.state("login",{url:"/home",templateUrl:"user/authentication/views/login.html",controller:"LoginController"}).state("main",{"abstract":!0,template:"<div  ui-view/>"}).state("main.initialRequirement",{url:"/initial_requirement",templateUrl:"user/authentication/views/initial_requirement.html",controller:"InitialRequirementController",data:{displayName:"Initial Requirement"}}).state("fundFrom",{"abstract":!0,url:"/bank_load",templateUrl:"user/static/views/bank_load.html"}).state("fundFrom.internetBanking",{url:"/internet_banking",templateUrl:"user/static/views/internet_banking.html",controller:"BankInfoController",data:{displayName:"Internet Banking"}}).state("fundFrom.mobileBanking",{url:"/mobile_banking",templateUrl:"user/static/views/mobile_banking.html",controller:"BankInfoController",data:{displayName:"Mobile Banking"}}).state("fundFrom.friend",{url:"/friend",templateUrl:"user/merchant/payments/views/request_from_friend.html",controller:"BankInfoController",data:{displayName:"Friend"}}).state("static",{"abstract":!0,template:'<div ui-view class="x_panel" "/>'}).state("static.westernUnion",{url:"/western_union",templateUrl:"user/static/views/western_union.html",controller:"StaticController",data:{displayName:"Western Union"}}).state("static.smsSyntax",{url:"/sms_syntax",templateUrl:"user/static/views/sms_syntax.html",controller:"StaticController",data:{displayName:"SMS Syntax"}}).state("static.aboutEsewa",{url:"/about_esewa",templateUrl:"user/static/views/about_esewa.html",controller:"StaticController",data:{displayName:"About eSewa"}}).state("static.faqs",{url:"/faqs",templateUrl:"user/static/views/faqs.html",controller:"StaticController",data:{displayName:"FAQs"}}).state("static.mobileApps",{url:"/mobile_apps",templateUrl:"user/static/views/mobile_apps.html",controller:"StaticController",data:{displayName:"Mobile Apps"}}).state("static.rewardPoint",{url:"/reward_point",templateUrl:"user/static/views/reward_point.html",controller:"StaticController"}).state("static.contactInformation",{url:"/contact_information",templateUrl:"user/static/views/contact_information.html",controller:"StaticController",data:{displayName:"Contacts"}}).state("static.privacy",{url:"/privacy",templateUrl:"user/static/views/privacy.html",controller:"StaticController",data:{displayName:"Privacy"}}).state("static.gettingStarted",{url:"/getting_started",templateUrl:"user/static/views/getting_started.html",controller:"StaticController",data:{displayName:"Getting Started"}}).state("static.security",{url:"/security",templateUrl:"user/static/views/security.html",controller:"StaticController",data:{displayName:"Security"}}).state("static.termsAndConditions",{url:"/terms_and_conditions",templateUrl:"user/static/views/terms_and_conditions.html",controller:"StaticController",data:{displayName:"Terms and Conditions"}}).state("authentication",{"abstract":!0,template:'<div ui-view ng-hide="isLoggedIn()" />'}).state("authentication.signup",{url:"/signup",templateUrl:"user/authentication/views/sign_up_form.html",controller:"SignUpController",data:{displayName:"Sign Up"}}).state("authentication.forgotPassword",{url:"/forgot_password",templateUrl:"user/authentication/views/forgot_password.html",controller:"ForgotPasswordController",data:{searchParams:["forgot password"],displayName:"Forgot Password",icon:"icon-es-change-password"}}).state("authentication.setPassword",{url:"/home",templateUrl:"user/authentication/views/set_password_for_inactive_user.html",controller:"LoginController",data:{displayName:"Set Password"}}).state("activateNotification",{url:"/notification/activate_email?:token&activation_type",templateUrl:"user/notificationids/views/email_activation.html",controller:"ActivationController",data:{displayName:"Notification Email Activation"}}).state("activate",{url:"/activate","abstract":!0,template:'<div class="theme_box" ui-view/>'}).state("activate.setPasswordForEmailUser",{url:"/signup?:token&activation_type",templateUrl:"user/logincredentials/views/set_password_for_secondary_email_user.html",controller:"ActivationController",data:{displayName:"Email User Activation"}}).state("activate.setPasswordForPrimaryUser",{url:"/signup/verify?:token",templateUrl:"user/logincredentials/views/set_password_for_email_user.html",controller:"ActivationController",data:{displayName:"User Activation"}}).state("activate.activateDevice",{url:"/device",templateUrl:d("/html/templates/activate_device_3.41.0.2.html"),controller:"ActivationController",data:{displayName:"Device Activation"}}).state("activate.setForgottenPassword",{url:"/forgot_password?:token",templateUrl:"user/authentication/views/set_forgotten_password.html",controller:"ActivationController",data:{displayName:"Forgot Password"}})}])}(),function(){angular.module("esewaUserApp").config(["$httpProvider",function(a){a.interceptors.push(["$rootScope","$q","AUTH_EVENTS","CDNUrl","ecmsg",function(a,b,c,d,e){return{request:function(b){return angular.isDefined(a.isLoggedIn)?(_.includes(b.url,d.url)?_.includes(b.url,"/documents")&&_.includes(b.url,".jpg")&&(b.headers.CacheControl="no-cache"):a.isLoggedIn()&&(_.includes(b.url,"/auth")||_.includes(b.url,"/logout")||_.includes(b.url,"/airlines"))&&(b.headers.uuid=a.userAuth.uuid),a.disableSubmit=!0,b):b},response:function(b){return a.disableSubmit=!1,b},responseError:function(d){a.disableSubmit=!1;var f=d.status;if(!_.includes(d.config.url,"reg")&&!_.includes(d.config.url,"authenticate")&&!_.includes(d.config.url,"forgot_password")){if(a.message={error:""},401===f||403===f)a.$broadcast(c.notAuthorized),a.message.error&&(_.includes(d.config.url,"payment_menus")||_.includes(d.config.url,"/products/showcase")||e.error(a.message.error,""));else if(500===f)return e.error("Sorry, something went wrong.",""),b.reject(d);""!==a.message.error&&angular.isDefined(a.message.error)&&(a.message.error?(e.error(a.message.error,""),document.body.scrollTop=document.documentElement.scrollTop=0):angular.isDefined(d.data.error_message)&&(_.includes(d.config.url,"make_payment")||_.includes(d.config.url,"payment")||_.includes(d.config.url,"validate")?a.message.error=d.data.error_message:_.includes(d.config.url,"payment_menus")||_.includes(d.config.url,"/products/showcase")||e.error(d.data.error_message,"")))}return b.reject(d)}}}])}])}(),function(){angular.module("esewaUserApp").controller("LoginController",["$scope","$rootScope","$state","AuthService","$http","AUTH_EVENTS","$timeout","$filter","ecmsg","ValidationService","StateConstant","$modal","ForgotPasswordService","$location","CDNUrl","$q","$window","$base64","$localStorage","RegexConstant","vcRecaptchaService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){function v(a){var b=p.defer(),c=new Image;return c.onerror=function(){b.resolve(!1)},c.onload=function(){b.resolve(!0)},c.src=a,b.promise}b.clearMessage(),a.password={},b.showApplicationProcessing=!1;var w="Invalid username or password";a.FocusLogin=!0,b.onEnableBtn=function(){b.disableLoginSubmit=!1};var x;a.getRecaptchaId=function(a){x=a};var y={},z=!1;a.cancel=function(){angular.isDefined(a.$modalInstance)&&a.$modalInstance.dismiss("cancel"),y={}},b.verifyCapcha=function(a){y=a,z=!0,l.open({templateUrl:o.url+"/html/templates/google_captcha_3.45.0.0.html",controller:"GoogleCaptchaController",size:"md"})},b.login=function(d,f){var h=d||y;if(!z&&!u.getResponse(x))return b.loginError="Please resolve the captcha to login.",void(b.loginErrorSHow=!0);if(b.disableLoginSubmit=!0,b.error={},!h.esewaId)return b.loginError="Invalid eSewa ID",b.loginErrorSHow=!0,g(function(){b.loginErrorSHow=!1},2e3),!1;if(!h.password)return b.loginError="Invalid Password",b.loginErrorSHow=!0,g(function(){b.loginErrorSHow=!1},2e3),!1;var j="loginMiniLoading";e({method:"POST",url:"/authenticate",headers:{esewa_id:h.esewaId,password:r.encode(h.password),"g-recaptcha-response":b.captchaId||u.getResponse(x)},params:{redirectForm:angular.isDefined(h.url)?h.url:""},data:""}).success(function(c){b.disableLoginSubmit=!1,a.cancel(),b.showLoadingBar=!1,c?""!==c&&angular.isDefined(c.location)&&(s.redirectUrl=c.location,q.location.href=c.location,c.location.startsWith("http")||q.location.reload()):q.location.reload()}).error(function(d,e){if(b.disableLoginSubmit=!1,b.handleMiniLoadingBar(j,!1),b.showLoadingBar=!1,a.cancel(),412===e)return b.loginInfo=[r.encode(h.esewaId),r.encode(h.password),d.user_token],q.trackLogEvent&&q.trackLogEvent({eventTitle:"Token Generated For Unknown Browser Login",eventType:"login"}),void c.go("activate.activateDevice");if(b.loginErrorSHow=!0,a.cancel(),d)if(d.set_password||d.password_expired===!0){var f=d.set_password?d.set_password:d.message,k=!1;"+"!==h.esewaId[0]||"+977"===h.esewaId.slice(0,4)||isNaN(h.esewaId.slice(1))||(k=!0),a.typeOfMobile(h.esewaId)||d.mobile_notification===!0||k?(b.passwordDto={esewaId:h.esewaId},i.info(f),b.loginErrorSHow=!1,c.go("authentication.setPassword")):i.info("Your Password has been Expired. Please reset your password. We have sent you an email with a link to reset password. Please check your email and follow the instructions.","")}else d.error_message?b.loginError=d.error_message:b.loginError=w;else b.loginError=w;g(function(){b.loginErrorSHow=!1},2e3)})["finally"](function(){"function"==typeof f&&f()})},a.typeOfMobile=function(a){return t.mobileNo.test(a)},a.checkPassword=function(){return a.passwordDto.newPassword===a.passwordDto.confirmNewPassword},a.checkPasswordValid=function(a,b){return a===b},a.checkPasswordRegex=function(a){return/[a-zA-z]/.test(a)&&/[0-9]/.test(a)&&a.length>7},a.disableButtonCondition=function(){return!a.checkPassword(a.passwordDto.newPassword,a.passwordDto.confirm_password)||!a.checkPasswordRegex(a.passwordDto.newPassword)||!a.checkPasswordRegex(a.passwordDto.confirmNewPassword)},a.setPassword=function(d){var e={password:d.newPassword,token:d.token,esewa_id:d.esewaId};a.disableButtonCondition()?i.error("Invalid password format.",""):m.setPasswordForInactiveUser(e).then(function(){b.clearMessage(),c.go("login")},function(a){b.showInformation=!1,angular.isDefined(a)&&(a.data.error_message?i.error(a.data.error_message,""):i.error("Service is currently unavailable. please, try again later to set password for the credentials."))})},b.openLoginDialog=function(a){return l.open({templateUrl:"/user/authentication/views/home_login_dialog.html",controller:"LoginPopupController",size:"login",backdrop:"static",keyboard:!1,resolve:{url:function(){return a}}})},a.getProfileImage=function(){var b=document.querySelector("#ACCOUNT_ICON");b&&(b.src=a.getUserIcon()),g(function(){e({method:"GET",url:"/api/web/auth/kyc/document/download",headers:{"Content-Type":void 0,uuid:e.defaults.headers.common.uuid},data:""}).success(function(b){if(b.file_name){var c=document.querySelector("#ACCOUNT_ICON");c&&(c.src="",v(b.file_name).then(function(d){d===!0?c.src=b.file_name:c.src=a.getUserIcon()}))}}).error(function(){g(function(){b&&(b.src=a.getUserIcon())},500)})},500)},a.getUserIcon=function(){return o.defaultAccountUrl}}])}(),function(){angular.module("esewaUserApp").service("AuthService",["Restangular",function(a){var b=a.all("auth"),c=a.all("esewa");this.authenticate=function(b){return a.one("authenticate").customPOST("","","",{esewa_id:b.esewaId,password:b.password})},this.registerUserUsingEsewaId=function(a,b){var d={esewa_id:a.esewaId,email:a.email,"g-recaptcha-response":b,terms_and_conditions:a.termsAndCondition,details:{full_name:a.details.full_name,gender:a.details.gender,promo_code:a.details.promo_code}};return c.all("reg").post(d)},this.validateToken=function(a){return c.one(a.esewaId+"").one("token").one(a.token+"").one("validate").customGET()},this.validateLastToken=function(a){return c.one(a.esewaId+"").one("token").one(a.token+"").one("validate").customGET()},this.changePassword=function(a){return b.one("change_password").customPOST("","","",{old_password:a.oldPassword,new_password:a.newPassword,mpin:a.mpin})},this.setPassword=function(a){var b={token:a.token};return c.one(a.esewaId+"").one("create_password").customPOST(b,"","",{password:a.password,mpin:a.mpin})},this.getInitialRequirements=function(){return b.one("initial_requirements").get()},this.getUserProfile=function(){return b.one("profile").customGET()},this.logout=function(b){return a.all("logout").customPOST("","","",{esewa_id:b})}}])}(),function(){angular.module("esewaUserApp").service("ForgotPasswordService",["Restangular",function(a){this.validateForgotPasswordId=function(b,c){return a.one(b+"").one("forgot_password").customGET("",{},{"g-recaptcha-response":c})},this.validateToken=function(b){return a.one(b.esewaId+"").one("forgot_password/validate").one(b.token+"").customGET()},this.setPasswordForgotPassword=function(b){var c={token:b.token,password:b.password};return a.one(b.esewaId+"").one("forgot_password").customPUT(c)},this.setPasswordForInactiveUser=function(b){return a.one(b.esewa_id+"").one("set_password").customPUT(b)}}])}(),function(){angular.module("esewaUserApp").controller("SignUpController",["$scope","$state","$timeout","$rootScope","ecmsg","InformationService","$sce","INFORMATION","StateConstant","$modal","CDNUrl",function(a,b,c,d,e,f,g,h,i,j,k){d.openSignUpDialog=function(a){return j.open({templateUrl:k.url+"/html/registration/sign_up_form.html",controller:"SignUpPopUpController",size:"signUp",backdrop:"static",keyboard:!1,resolve:{loginData:function(){return a}}})}}])}(),function(){angular.module("esewaUserApp").controller("LoginPopupController",["$rootScope","$scope","url","$state","$modalInstance","$timeout","$window",function(a,b,c,d,e,f,g){b.cancel=function(){e.dismiss()},a.url=c,a.currentModal=e,b.login=function(b){g.trackLogEvent&&g.trackLogEvent({eventTitle:"Login From Payment Menu or Showcase",eventType:"login"}),angular.isDefined(c)&&""!==c&&(b.url=c),a.login(b)}}])}(),function(){angular.module("esewaUserApp").controller("SignUpPopUpController",["$rootScope","ecmsg","AUTH_EVENTS","AuthService","INFORMATION","$scope","loginData","$state","$modalInstance","$timeout","vcRecaptchaService","$window","StateConstant",function(a,b,c,d,e,f,g,h,i,j,k,l,m){f.cancel=function(){i.dismiss()},a.targetLogin=g,a.currentModal=i,f.tokenDto="",f.gender="",f.mobileNo=null,f.showRegFormView=!f.showAlreadyGotTokenView;var n=e.primaryRegistration;a.showInformation=n,a.showInformation=!1,a.isLoggedIn()&&h.current.name===m.SIGN_UP&&a.logout(),f.showSignUpView=function(){f.showRegFormView=!0,f.showEmailSentView=!0,h.go(m.SIGN_UP)},f.getAdditionalProperties=function(){return f.additionalProperties={mobile_number:f.signUpDto.esewaId,email_address:f.signUpDto.email,properties:{gender:f.signUpDto.details.gender,full_name:f.signUpDto.details.full_name}},f.additionalProperties},f.clearFormData=function(){f.signUpDto={esewaId:"",termsAndCondition:!1,details:{full_name:"",gender:"",promo_code:""},email:"",token:""},f.tokenDto={token:"",esewaId:""},f.passwordDto={newPassword:"",confirmNewPassword:"",mpin:""},f.activationDto={esewaId:"",token:""}},f.clearFormData(),f.clearMessage=function(){a.message.error="",f.signUpMessage="",f.mobileNo=null};var o;f.getRecaptchaId=function(a){o=a},f.setGender=function(a){switch(a){case"male":f.signUpDto.details.gender="M";break;case"female":f.signUpDto.details.gender="F";break;case"other":f.signUpDto.details.gender="O";break;default:f.signUpDto.details.gender=""}},f.registerUser=function(){return a.showApplicationProcessing=!0,void 0===f.signUpDto?void(f.signUpMessage="Please type your mobile number !"):(f.clearMessage(),void(k.getResponse(o)?(d.registerUserUsingEsewaId(f.signUpDto,k.getResponse(o)).then(function(b){a.showApplicationProcessing=!1,f.registrationResponse=b,f.showRegFormView=!1,f.showEmailSentView=!0,l.trackLogEvent&&l.trackLogEvent({eventTitle:"User Registered",eventType:"sign_up"})},function(c){a.showApplicationProcessing=!1,a.showInformation=!1,angular.isDefined(c)&&(c.data.error_message?b.error(c.data.error_message,""):a.message.error="Error occurred while registration, please, try again later.")}),k.reload(o)):(a.message.error="Please resolve the captcha and submit!",a.showApplicationProcessing=!1)))},f.validateToken=function(){f.clearMessage();var c={token:f.tokenDto.token,esewaId:f.signUpDto.esewaId};d.validateToken(c).then(function(a){f.tokenDtoValidationRespone=a.plain(),f.tokenDtoValidation=!1,f.showRegFormView=!1,f.showTokenValidationView=!1,f.showSetPasswordView=!0,f.showAlreadyGotTokenView=!1,f.showTokenActivationView=!1,n=e.primaryRegistrationPasswordValidation,f.getInformationDetail()},function(c){a.showInformation=!1,angular.isDefined(c)&&(c.data.error_message?b.error(c.data.error_message,""):a.message.error="Error while validating token. Please, try agin later.")})},f.checkPassword=function(a,b){return a===b},f.setPassword=function(){if(!f.passwordDto||!f.signUpDto)return!1;f.loginDto={esewaId:f.signUpDto.esewaId,password:f.passwordDto.newPassword},f.clearMessage();var c={token:f.tokenDto.token,esewaId:f.signUpDto.esewaId,password:f.passwordDto.newPassword,mpin:f.passwordDto.mpin};d.setPassword(c).then(function(b){f.successResponse=b.plain(),f.successResponse.message&&j(function(){a.successMessageForIndex=!0,a.message.success=f.successResponse.message,f.cancel(),a.showApplicationProcessing=!1},500),a.showSignUpForm=!1,angular.isFunction(a.login)?(a.showWelcomePage=!1,f.showRegFormView=!0,f.showTokenValidationView=!1,f.showSetPasswordView=!1,f.showAlreadyGotTokenView=!1,f.showTokenActivationView=!1,a.showApplicationProcessing=!0,a.login(f.loginDto)):(f.loginDto={},h.go(m.LOGIN))},function(c){a.showInformation=!1,angular.isDefined(c)&&(c.data.error_message?b.error(c.data.error_message,""):a.message.error="Error while validating token. Please, try agin later.")})},f.registerUserIdAndToken=function(){return!!f.activationDto&&(f.clearMessage(),void d.validateLastToken(f.activationDto).then(function(){f.tokenDto={token:f.activationDto.token},f.signUpDto={esewaId:f.activationDto.esewaId,termsAndCondition:!0,details:{gender:"",full_name:"",promo_code:""}},f.mobileNo=f.activationDto.esewaId||null,f.showRegFormView=!1,f.showTokenValidationView=!1,f.showSetPasswordView=!0,f.showAlreadyGotTokenView=!1,f.showTokenActivationView=!1},function(c){a.showInformation=!1,angular.isDefined(c)&&(c.data.error_message?b.error(c.data.error_message,""):a.message.error="Error while validating token. Please, try agin later.")}))},f.showTokenActivation=function(){f.clearMessage(),n=e.primaryRegistration,f.getInformationDetail(),f.showRegFormView=!1,f.showTokenActivationView=!0,f.showAlreadyGotTokenView=!0},f.getInformationDetail=function(){a.informationKey=n,f.clearMessage(),a.$broadcast(c.information)},f.validateRegisterForm=function(){return!!(f.signUpDto.esewaId&&f.signUpDto.termsAndCondition&&f.signUpDto.details.full_name&&f.signUpDto.email&&f.signUpDto.details.gender)}}])}(),function(){angular.module("esewaUserApp").controller("ForgotPasswordController",["$scope","$rootScope","$state","$http","ForgotPasswordService","$timeout","InformationService","INFORMATION","$sce","ecmsg","RegexConstant","StateConstant","AUTH_EVENTS","vcRecaptchaService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){function o(){b.informationKey=q,b.$broadcast(m.information)}a.showForgotPasswordFirstForm=!0,a.forgotPasswordShow=function(){a.clearMessage(),b.esewaId="",a.showForgotPasswordForm=!0,a.showForgotPasswordFirstForm=!0,a.showForgotPasswordSecondForm=!1,a.showForgotPasswordThirdForm=!1,c.go(l.FORGOT_PASSWORD)},a.forgotPasswordDto={esewaId:"",token:""};var p;a.getRecaptchaId=function(a){p=a},a.forgotPwdRegister=function(){n.getResponse(p)?(e.validateForgotPasswordId(a.forgotPasswordDto.esewaId,n.getResponse(p)).then(function(d){a.forgotPassword=d.plain(),a.forgotPassword.mobile_notification===!0?(a.showForgotPasswordFirstForm=!1,a.showForgotPasswordSecondForm=!0,b.message.success=a.forgotPassword.message,b.clearMessage()):(b.message.success="We have sent you an email with a link to reset password. Please check your email and follow the instructions",c.go(l.LOGIN))},function(a){b.showInformation=!1,angular.isDefined(a)&&(a.data.error_message?j.error(a.data.error_message):b.message.error="Service is currently unavailable. Please, Try again later.")}),n.reload(p)):b.message.error="Please resolve the captcha and submit!"},a.typeOfMobile=function(a){return k.mobileNo.test(a)},a.validateTokenForgotPwd=function(){e.validateToken(a.forgotPasswordDto).then(function(c){a.tokenValidationResponse=c.plain(),a.showForgotPasswordFirstForm=!1,a.showForgotPasswordSecondForm=!1,a.showForgotPasswordThirdForm=!0,b.clearMessage()},function(a){b.showInformation=!1,angular.isDefined(a)&&(a.data.error_message?j.error(a.data.error_message,""):j.error("Service is currently unavailable. please, try again later to set password for the credentials."))})},a.setPasswordForGotPwd=function(){a.setPasswordDto={token:a.forgotPasswordDto.token,password:a.passwordDto.newPassword,esewaId:a.forgotPasswordDto.esewaId},e.setPasswordForgotPassword(a.setPasswordDto).then(function(c){a.forgotPassword=c.plain(),f(function(){a.successMessageForIndex=!0,b.message.success=a.forgotPassword.message,b.message.success||(b.message.success="Password has been successfully changed."),j.success(b.message.success,"")},500),b.logout()},function(a){b.showInformation=!1,angular.isDefined(a)&&(a.data.error_message?j.error(a.data.error_message,""):b.message.error="Service is currently unavailable. please, try again later to set password for the credentials.")})},a.passwordDto={newPassword:"",confirmNewPassword:""},a.checkPassword=function(){return a.passwordDto.newPassword===a.passwordDto.confirmNewPassword};var q=h.forgotPassword;a.getInformation=function(){o()},a.cancel=function(){c.go(l.HOME_MAIN)}}])}(),function(){angular.module("esewaUserApp").controller("GoogleCaptchaController",["$rootScope","$scope","$modalInstance","vcRecaptchaService",function(a,b,c,d){var e;b.getRecaptchaId=function(a){e=a},b.$modalInstance=c,b.$parent.$modalInstance=c,b.cancel=function(){c.dismiss()},b.showSpinner=!1,b.getCaptchaId=function(){return d.getResponse(e)?(b.showSpinner=!0,void a.login("",function(){b.showSpinner=!1})):(a.loginError="Please resolve the captcha to login.",void(a.loginErrorSHow=!0))}}])}(),function(){angular.module("esewaUserApp").controller("StaticController",["$scope","$state","$rootScope","StateConstant",function(a,b,c,d){a.staticMenus=[{url:d.TOPUP,name:"Direct Topup"},{url:d.AIRLINES_HOME,name:"Airlines"},{url:d.WU,name:"Fund Transfer"}],a.setShowStaticContent=function(d){c.showStaticContent=!0,a.showStaticContent=!0,b.go(d)}}])}(),function(){angular.module("esewaUserApp").controller("BankInfoController",["$scope","$rootScope","$state","InformationService",function(a,b,c,d){d.getInternetBankingDetails().then(function(b){a.internetBankingDetails=b.plain().bank_list},function(a){angular.isDefined(a)?b.message=a.data.error_message:b.message="Error while fetching data."}),d.getMobileBankingDetails().then(function(b){return a.mobileBankingDetails=b.plain().bank_list,a.mobileBankingDetails},function(a){angular.isDefined(a)?b.message=a.data.error_message:b.message="Error while fetching data."})}])}(),function(){angular.module("esewaUserApp").controller("ActivationController",["$scope","$rootScope","$state","$stateParams","ActivationService","ecmsg","$sce","INFORMATION","InformationService","$timeout","StateConstant","AUTH_EVENTS","$base64",function(a,b,c,d,e,f,g,h,i,j,k,l,m){a.token=d.token,a.currentState=c.current.name;var n="";a.esewaId="",b.showApplicationProcessing=!1,b.message.error="","activate.setPasswordForEmailUser"===a.currentState&&("NOTIFICATION_ACTIVATION"===d.activation_type?(a.notificationDto={token:a.token},b.showApplicationProcessing=!0,e.getUserTokenActivation(a.token,"NOTIFICATION_ACTIVATION").then(function(b){a.response=b.plain(),f.success(b.username||"Notification id added successfully.")},function(){f.error("Activation link is either invalid or expired !!","")})["finally"](function(){b.showApplicationProcessing=!1,c.go("login")})):e.getUserTokenActivation(a.token,"USER_ACTIVATION").then(function(b){a.response=b.plain(),a.response&&(a.esewaId=a.response.username,a.showToken=!1)},function(){f.error("Activation link is either invalid or expired !!",""),c.go("login")})),"activate.setPasswordForPrimaryUser"===a.currentState&&e.getUserTokenActivation(a.token,"USER_ACTIVATION").then(function(b){a.response=b.plain(),a.response&&(a.esewaId=a.response.username,a.showToken=!0,e.sendPrimaryUserToken(a.esewaId,a.token).then(function(b){a.response=b.plain(),a.token=""},function(a){console.log(a),a.data.error_message?f.error(a.data.error_message,""):f.error("Activation link is either invalid or expired !!",""),c.go("login")}))},function(){f.error("Activation link is either invalid or expired !!",""),c.go("login")}),"activate.activateDevice"===a.currentState?Array.isArray(b.loginInfo)?a.esewaId=m.decode(b.loginInfo[0]):c.go("login"):"activate.setForgottenPassword"===a.currentState&&e.getUserTokenActivation(a.token,"FORGET_PASSWORD").then(function(b){a.response=b.plain(),a.response&&(a.esewaId=a.response.username),n=h.forgotPasswordValidation},function(){f.error("Activation link is either invalid or expired !!",""),c.go("login")}),""===a.currentState&&(a.showDeviceActivationSection=!0),"activateNotification"===a.currentState&&b.isAuthenticated()&&(a.notificationDto={token:a.token},e.getUserTokenActivation(a.token,"USER_ACTIVATION").then(function(b){a.response=b.plain(),a.response&&(a.esewaId=a.response.username,a.showToken=!1)},function(){f.error("Activation link is either invalid or expired !!",""),c.go("login")})),a.password={password:"",confirm_password:""},a.setPasswordForEmailUser=function(){if("NOTIFICATION_ACTIVATION"===d.activation_type)e.getUserTokenActivation(a.token,"NOTIFICATION_ACTIVATION").then(function(b){a.response=b.plain(),f.success("Notification Id has been added successfully.","")},function(){f.error("Activation link is either invalid or expired !!","")})["finally"](function(){c.go("login")});else{if(!a.esewaId&&!a.passwordDto.mobileToken&&"activate.setPasswordForPrimaryUser"===a.currentState)return;a.tokenDto={token:a.token,mobileToken:a.passwordDto.mobileToken},a.passwordDto.newPassword===a.passwordDto.confirmNewPassword?e.setPasswordForEmailUser(a.esewaId,a.tokenDto,a.passwordDto).then(function(b){f.success(b.plain().message,""),c.go("login"),a.disableSubmit=!1},function(b){a.disableSubmit=!1,angular.isDefined(b.data.error_message)?f.error(b.data.error_message,""):f.error("Invalid Request !!","")}):f.error("Please, Check your password !!","")}},a.setNewForgottenPassword=function(){a.setPasswordDto={token:a.token,password:a.passwordDto.password},a.disableButtonCondition()?f.error("Invalid password format.",""):e.setNewForgottenPassword(a.esewaId,a.setPasswordDto).then(function(a){f.success(a.plain().message,""),c.go("login")},function(a){angular.isDefined(a.data)?f.error(a.data.error_message,""):f.error("Invalid request!","")})},a.checkPassword=function(){return a.password.password===a.password.confirm_password},a.checkPasswordValid=function(a,b){return a===b},a.checkPasswordRegex=function(a){return/[a-zA-z]/.test(a)&&/[0-9]/.test(a)&&a.length>7},a.disableButtonCondition=function(){return!a.checkPasswordRegex(a.passwordDto.password)||!a.checkPasswordRegex(a.passwordDto.confirm_password)||!a.checkPasswordValid(a.passwordDto.password,a.passwordDto.confirm_password)},a.cancel=function(){c.go("login")},a.showInformation=!1,n&&(b.informationKey=n,b.$broadcast(l.information)),a.validateTokenDeviceActivation=function(a){var c=Array.isArray(b.loginInfo)?b.loginInfo[2]:"";b.disableValidateTokenBtn=!0,e.activateDevice(a,c).then(function(){var a=Object.assign([],b.loginInfo);b.login({esewaId:m.decode(a[0]),password:m.decode(a[1])})},function(a){angular.isDefined(a.data)?f.error(a.data.error_message,""):f.error("Invalid request!","")})["finally"](function(){b.disableValidateTokenBtn=!1})},a.addNotification=function(){f.error("You must be logged in for this operation.","")},a.getEsewaId=function(){if(b.loginInfo){var a=m.decode(b.loginInfo[0]);
return a}}}])}(),function(){angular.module("esewaUserApp").service("ActivationService",["Restangular",function(a){this.getUserTokenActivation=function(b,c){var d=_.merge({activation_type:c},{token:b});return a.one("token").one("validate").get(d)},this.setPasswordForEmailUser=function(b,c,d){var e={token:c.token};return c.mobileToken&&(e.token=c.mobileToken),a.one("esewa").one(b+"").one("create_password").customPOST(e,"","",{password:d.newPassword,username:d.username,mpin:d.mpin})},this.setNewForgottenPassword=function(b,c){return a.one(b+"").one("forgot_password").customPUT(c)},this.resendNotification=function(b,c){var d={type:b,notification_id:c};return a.one("auth").one("token").one("resend").customPUT(d)},this.sendPrimaryUserToken=function(b,c){var d={esewa_id:b,token:c};return a.one("esewa").one("verify_email").customPOST(d)},this.activateDevice=function(b,c){return a.one("device/verify").withHttpConfig({selfHandleLoadingBar:!0}).customPOST({token:b,user_token:c})}}])}();